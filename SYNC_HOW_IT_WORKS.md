# –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

## üéØ –ß—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è

‚úÖ **–ó–∞–º–µ—Ç–∫–∏** (`notes`) - —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏ –∫ –∑–∞–¥–∞—á–µ  
‚úÖ **–°—Ç–∞—Ç—É—Å—ã** (`issue_statuses`) - –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ (–ù–æ–≤–∞—è, –í —Ä–∞–±–æ—Ç–µ, –∏ —Ç.–¥.)  
‚ùå **–ê–¥—Ä–µ—Å–∞, –∫–æ–¥—ã –æ—Ñ–∏—Å–æ–≤, —Ç–∏–ø—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤** - –ù–ï —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è (—Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ)

## üìä –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### 1Ô∏è‚É£ –õ–∏—á–Ω—ã–π —Ä–µ–∂–∏–º (Personal Mode)
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ** (IndexedDB + chrome.storage)
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–∫–∏–¥–∞—é—Ç –≤–∞—à –±—Ä–∞—É–∑–µ—Ä
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é

### 2Ô∏è‚É£ –ö–æ–º–∞–Ω–¥–Ω—ã–π —Ä–µ–∂–∏–º (Team Mode)
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è **–ª–æ–∫–∞–ª—å–Ω–æ –ò –≤ Supabase**
- –¢—Ä–µ–±—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–≤—Ö–æ–¥–∞
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –∫–æ–º–∞–Ω–¥—ã
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –æ—Ñ—Ñ–ª–∞–π–Ω (–æ—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–º–µ—Ç–∫–∏:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∑–∞–º–µ—Ç–∫—É
2. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (IndexedDB/chrome.storage)
3. –ï—Å–ª–∏ —Ä–µ–∂–∏–º = "team" && –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç:
   ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Supabase
   ‚úÖ –î—Ä—É–≥–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã –ø–æ–ª—É—á–∞—é—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
4. –ï—Å–ª–∏ —Ä–µ–∂–∏–º = "team" && –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞:
   ‚è≥ –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   ‚è≥ –û—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
```

### –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç—É—Å
2. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
3. –ï—Å–ª–∏ —Ä–µ–∂–∏–º = "team":
   ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Supabase
   ‚úÖ –î—Ä—É–≥–∏–µ –≤–∏–¥—è—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
```

## üèóÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∞–π–ª—ã:

- **`content.js`** - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç UI –∏ –¥–∞–Ω–Ω—ã–µ
  - `saveNote()` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ + –≤—ã–∑—ã–≤–∞–µ—Ç `syncManager.saveNote()`
  - `saveStatus()` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ + –≤—ã–∑—ã–≤–∞–µ—Ç `syncManager.saveStatus()`

- **`sync.js`** - –∫–ª–∞—Å—Å `SupabaseSync`, —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
  - `saveNote()` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–º–µ—Ç–∫—É –≤ Supabase
  - `saveStatus()` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ Supabase
  - `setupRealtimeSubscription()` - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

- **`settings.js`** - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
  - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É Personal/Team —Ä–µ–∂–∏–º–∞–º–∏
  - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–≤—Ö–æ–¥/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
  - –°–æ–∑–¥–∞–Ω–∏–µ/–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–∞–Ω–¥–µ

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É Jira
2. `content.js` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `syncMode`:
   - –ï—Å–ª–∏ `personal` ‚Üí —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ
   - –ï—Å–ª–∏ `team` ‚Üí –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º `SupabaseSync`
4. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ UI ‚Üí –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ ‚Üí –µ—Å–ª–∏ team ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è

### Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```javascript
// sync.js –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Supabase
this.supabase
  .channel('notes-channel')
  .on('postgres_changes', { 
    event: 'UPDATE', 
    schema: 'public', 
    table: 'notes' 
  }, (payload) => {
    // –£–≤–µ–¥–æ–º–ª—è–µ–º content.js –æ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    window.dispatchEvent(new CustomEvent('note-updated', {
      detail: payload.new
    }));
  })
  .subscribe();
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

### –í–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –∫–æ–º–∞–Ω–¥—ã:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Settings (–∏–∫–æ–Ω–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Üí Settings)
2. –í—ã–±–µ—Ä–∏—Ç–µ "Team Mode"
3. –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å
4. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12) –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Jira
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É
3. –ò—â–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏:
   ```
   ‚òÅÔ∏è Initializing Supabase sync for content.js...
   ‚úÖ Supabase sync initialized in content.js
   ‚òÅÔ∏è Note synced to Supabase: TASK-123
   ```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ø–∞–ª–æ –≤ –ë–î:

–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí Table Editor ‚Üí `notes`:
- –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å—å —Å `issue_key`, `text`, `team_id`

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ó–∞–º–µ—Ç–∫–∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∂–∏–º**: Settings ‚Üí –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "Team Mode"
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ö–æ–¥**: Settings ‚Üí –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–∞—à email
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–º–∞–Ω–¥—É**: Settings ‚Üí –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞
4. **–ö–æ–Ω—Å–æ–ª—å**: –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `‚ùå` –∏–ª–∏ `‚ö†Ô∏è`

### –†–µ–∫—É—Ä—Å–∏—è RLS –ø–æ–ª–∏—Ç–∏–∫:

–°–º. —Ñ–∞–π–ª `RLS_FINAL.md` - —Ç–∞–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–∏.

### –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 1 –≤–º–µ—Å—Ç–æ 2:

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase SQL:
```sql
DROP POLICY IF EXISTS "team_members_select" ON team_members;

CREATE POLICY "team_members_select" ON team_members
  FOR SELECT
  USING (
    team_id IN (SELECT id FROM teams WHERE created_by = auth.uid())
    OR
    user_id = auth.uid()
  );
```

## üìù –ß—Ç–æ –¥–∞–ª—å—à–µ?

- [ ] –î–æ–±–∞–≤–∏—Ç—å UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–∏–∫–æ–Ω–∫–∞ –æ–±–ª–∞–∫–∞)
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º –∏–∑–º–µ–Ω–∏–ª –∑–∞–º–µ—Ç–∫—É
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (audit_log)
- [ ] –ö–æ–Ω—Ñ–ª–∏–∫—Ç-—Ä–µ–∑–æ–ª—é—Ü–∏—è –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∫–∞—Ö
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–æ–≤/–∫–æ–¥–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
